<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebITG - Home</title>
</head>
<body>
<form id="uploadForm">
    <input type="file" name="file" />
    <button type="submit">Upload</button>
</form>

<progress id="progressBar" value="0" max="100" style="width:300px;"></progress>
<p id="status"></p>

<script type="module">
    const form = document.getElementById("uploadForm");
    const progressBar = document.getElementById("progressBar");
    const statusText = document.getElementById("status");

    form.addEventListener("submit", (e) => {
        e.preventDefault();

        const fileInput = form.querySelector("input[type='file']");
        if (!fileInput.files?.length) return;

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);

        const xhr = new XMLHttpRequest();

        // track progress
        xhr.upload.addEventListener("progress", (e) => {
            if (e.lengthComputable) {
                const percent = (e.loaded / e.total) * 100;
                progressBar.value = percent;
                statusText.textContent = `Uploading... ${Math.round(percent)}%`;
            }
        });

        xhr.addEventListener("load", () => {
            statusText.textContent = "✅ Upload complete!";
        });

        xhr.addEventListener("error", () => {
            statusText.textContent = "❌ Upload failed!";
        });

        xhr.open("POST", "http://localhost:3000/upload");
        xhr.send(formData);

        xhr.onreadystatechange = function () {
            if(xhr.readyState === XMLHttpRequest.DONE) {
                if(xhr.status === 200) {
                    console.log(xhr.responseText);
                }
            }
        }
    });
</script>
</body>
</html>
